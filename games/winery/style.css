/* === 狄奥尼索斯的酒庄 V9.1 Style (商店互动优化版) === */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    background-color: #2c241e;
    color: #d7c8b8;
    font-family: 'Noto Serif SC', serif;
    margin: 0; padding: 0;
    height: 100vh;
    display: flex; justify-content: center; align-items: center;
    overflow: hidden;
}

.game-container {
    width: 100%; height: 100%; max-width: 600px;
    background-color: #3c322a;
    display: flex; flex-direction: column;
    position: relative;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

/* === 1. 开始页面 (V9.3 统一美化版) === */
#start-screen {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to bottom, #2c241e, #1a120b); /* 加深背景层次 */
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 200;
}

.title-area { text-align: center; margin-bottom: 50px; }
.title-area h1 { 
    font-size: 42px; color: #e6a23c; margin: 0; 
    line-height: 1.2; text-shadow: 0 4px 15px rgba(0,0,0,0.9); 
    letter-spacing: 6px;
    font-family: 'Noto Serif SC', serif;
    border-bottom: 1px solid rgba(230, 162, 60, 0.3);
    padding-bottom: 15px;
    display: inline-block;
}

/* 按钮容器 */
.menu-box {
    display: flex; flex-direction: column;
    gap: 15px; align-items: center; 
    width: 240px; /* 稍微宽一点 */
}

/* 统一的主按钮样式 */
.start-btn {
    width: 100%;
    padding: 14px 0;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #e6a23c;
    color: #e6a23c;
    font-family: inherit; font-size: 16px; font-weight: bold;
    letter-spacing: 2px;
    cursor: pointer; text-align: center; text-decoration: none;
    transition: all 0.2s ease;
    border-radius: 2px; /*稍微硬朗一点的圆角*/
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.start-btn:hover {
    background: rgba(230, 162, 60, 0.1);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(230, 162, 60, 0.1);
}

.start-btn:active {
    transform: translateY(1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

/* 次要按钮 (开始新游戏) - 低调处理 */
.start-btn.secondary { 
    border: 1px solid #5d4037; 
    color: #8a7a68; 
    font-size: 14px; 
    background: transparent;
    box-shadow: none;
    padding: 12px 0;
}

.start-btn.secondary:hover { 
    color: #d7c8b8; 
    border-color: #8a7a68;
    background: rgba(255,255,255,0.02);
    transform: none;
}

.version-text { position: absolute; bottom: 15px; right: 15px; font-size: 10px; color: #4a3f35; opacity: 0.6; }

/* === 2. 游戏主界面 === */
#game-interface {
    width: 100%; height: 100%;
    display: flex; flex-direction: column;
    flex: 1; 
}

/* 状态栏 */
.status-bar {
    height: 60px; background-color: #2c241e;
    border-bottom: 2px solid #8a7a68;
    display: flex; justify-content: space-between;
    align-items: center;
    padding: 0 15px; font-size: 14px; flex-shrink: 0; z-index: 50;
}

.status-left, .status-right {
    display: flex; align-items: center; gap: 10px;
}

.status-item { display: flex; align-items: center; gap: 5px; }
.status-item i { color: #e6a23c; }
#money-display { transition: color 0.2s; font-weight: bold; }

.weather-box { display: flex; align-items: center; }
#weather-icon { font-size: 18px; color: #e6a23c; }

/* 头部下一天按钮 */
.header-next-btn {
    background-color: #e6a23c; color: #2c241e;
    border: none; padding: 6px 12px; border-radius: 20px;
    font-weight: bold; cursor: pointer; font-size: 12px;
    display: flex; align-items: center; gap: 5px;
    transition: transform 0.1s, filter 0.2s;
}
.header-next-btn:hover { filter: brightness(1.1); }
.header-next-btn:active { transform: scale(0.95); }

/* 屏幕区域 */
.game-screen {
    flex: 1; position: relative; overflow: hidden;
    background-color: #4a3f35;
    display: flex; flex-direction: column;
}
#scene-content { width: 100%; height: 100%; overflow-y: auto; }

/* 底部导航 */
.bottom-nav {
    height: 70px; background-color: #2c241e;
    border-top: 2px solid #8a7a68;
    display: flex; justify-content: space-around; align-items: center;
    flex-shrink: 0; z-index: 50;
}
.nav-btn {
    background: none; border: none; color: #95a5a6;
    font-family: inherit; font-size: 10px;
    display: flex; flex-direction: column; align-items: center;
    gap: 5px; cursor: pointer; width: 16.6%; transition: color 0.2s;
}
.nav-btn.active { color: #e6a23c; transform: translateY(-2px); }
.nav-btn i { font-size: 20px; margin-bottom: 2px; }

/* === 农场 === */
.farm-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    height: 100%; width: 100%;
    padding: 10px; gap: 8px;
    background: linear-gradient(to bottom, #4a3f35 0%, #5d4037 100%);
}
.plot-cell {
    background-color: rgba(252, 251, 251, 0.2);
    border-radius: 8px;
    position: relative;
    display: flex; justify-content: center; align-items: center;
    cursor: pointer;
    border: 2px solid transparent;
    transition: background-color 0.2s, border-color 0.2s;
    overflow: hidden;
}
.crop-image {
    width: 80%; height: 80%;
    object-fit: contain;
    image-rendering: pixelated;
    z-index: 1;
}

.plot-cell.locked { background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
.plot-cell.selected { border-color: #e6a23c; background-color: rgba(230, 162, 60, 0.15); }

.water-indicator {
    position: absolute; top: 5px; left: 5px;
    width: 6px; height: 40px;
    background-color: rgba(0,0,0,0.3);
    border-radius: 3px; overflow: hidden;
}
.water-bar {
    width: 100%; position: absolute; bottom: 0;
    transition: height 0.3s, background-color 0.3s;
}

/* === 商店/仓库/设置 通用列表 === */
.tab-header {
    display: flex; background-color: #2c241e;
    border-bottom: 1px solid #8a7a68;
}
.tab-header button {
    flex: 1; padding: 15px; background: none; border: none;
    color: #95a5a6; font-family: inherit; cursor: pointer; font-size: 14px;
}
.tab-header button.active { color: #e6a23c; border-bottom: 3px solid #e6a23c; font-weight: bold; }

.list-container {
    padding: 15px;
    display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
}
.card-item {
    background-color: #3c322a; border: 1px solid #8a7a68;
    border-radius: 8px; padding: 15px; text-align: center;
    transition: transform 0.2s;
}
.card-item:active { transform: scale(0.98); }
.upgrade-card { border-color: #e6a23c; }
.card-title { font-weight: bold; color: #e6a23c; margin-bottom: 5px; font-size: 14px; }
.card-desc { font-size: 11px; color: #95a5a6; margin-bottom: 10px; height: 30px; overflow: hidden; }
.card-price { font-size: 12px; color: #d7c8b8; background: #2c241e; padding: 2px 8px; border-radius: 10px; display: inline-block; }

.action-btn {
    background-color: #e6a23c; color: #2c241e; border: none;
    padding: 10px; border-radius: 4px; font-weight: bold;
    cursor: pointer; margin-top: 8px; width: 100%; font-size: 12px;
    transition: filter 0.2s, transform 0.1s;
}
.action-btn:hover { filter: brightness(1.1); }
.action-btn:active { transform: translateY(2px); }
.action-btn.danger { background-color: #c0392b; color: white; }
.action-btn.secondary { background-color: #5d4037; color: #d7c8b8; }

/* === 设置页面 === */
.settings-container { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
.setting-row {
    background-color: #3c322a; padding: 15px; border-radius: 8px;
    display: flex; justify-content: space-between; align-items: center;
    border: 1px solid #5d4037;
}
.setting-label { font-weight: bold; color: #d7c8b8; }

/* === 浮动操作栏 === */
.floating-controls {
    position: absolute; bottom: 20px; left: 50%;
    transform: translateX(-50%);
    display: flex; flex-direction: column;
    gap: 10px;
    background-color: rgba(44, 36, 29, 0.98);
    padding: 15px; border-radius: 15px;
    border: 1px solid #e6a23c; z-index: 30;
    box-shadow: 0 10px 20px rgba(0,0,0,0.6);
    width: auto; min-width: 200px; max-width: 90%; 
}
.plot-info-card {
    background: rgba(0,0,0,0.3);
    padding: 10px; border-radius: 8px;
    margin-bottom: 5px;
}
.info-title { font-weight: bold; font-size: 16px; margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px;}
.info-row { display: flex; justify-content: space-between; font-size: 12px; color: #d7c8b8; margin-bottom: 3px; }
.control-buttons-row { display: flex; justify-content: space-around; width: 100%; }

.control-btn {
    width: 45px; height: 45px; border-radius: 50%;
    border: none; background-color: #3c322a;
    color: #d7c8b8; font-size: 20px; cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    transition: transform 0.1s, background-color 0.2s;
}
.control-btn:active { transform: scale(0.9); }
.control-btn:hover { background-color: #e6a23c; color: #2c241e; }

/* === 侧边弹窗 (Toast) === */
#toast-container {
    position: fixed; top: 70px; right: 10px; z-index: 999;
    display: flex; flex-direction: column; gap: 10px;
    pointer-events: none;
}
.toast-msg {
    background: rgba(44, 36, 29, 0.95);
    border-left: 4px solid #e6a23c;
    color: #d7c8b8; padding: 12px 15px; border-radius: 4px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    min-width: 200px; max-width: 300px;
    display: flex; justify-content: space-between; align-items: flex-start;
    pointer-events: auto; font-size: 13px;
}
.toast-content { flex: 1; line-height: 1.4; }
.toast-close {
    background: none; border: none; color: #95a5a6;
    font-size: 16px; cursor: pointer; margin-left: 10px;
    padding: 0; line-height: 1;
}
.toast-close:hover { color: #e74c3c; }

/* 动画定义 */
@keyframes slideUp { from { transform: translate(-50%, 20px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
.slide-up { animation: slideUp 0.3s ease-out; }
@keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.slide-in-right { animation: slideInRight 0.3s ease-out; }
.fade-out { opacity: 0; transition: opacity 0.5s; }
.hidden { display: none !important; }

/* 弹窗 (Modal) */
.modal-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); z-index: 100;
    display: flex; justify-content: center; align-items: center;
}
.modal-box {
    background: #2c241e; border: 2px solid #e6a23c;
    padding: 25px; border-radius: 15px; text-align: center; width: 80%;
    box-shadow: 0 0 30px rgba(0,0,0,0.8);
}
.scale-up { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

/* 酿造槽位样式 */
.barrel-slot {
    background-color: #3e2723; border: 2px solid #5d4037;
    border-radius: 10px; padding: 15px;
    display: flex; align-items: center; gap: 15px;
    cursor: pointer; transition: transform 0.2s;
}
.barrel-slot:hover { transform: translateX(5px); border-color: #e6a23c; }
.barrel-icon {
    width: 50px; height: 50px; background-color: #2c1e16;
    border-radius: 50%; display: flex; justify-content: center; align-items: center;
    font-size: 24px; color: #8d6e63;
}
.barrel-icon.working { color: #e6a23c; border: 2px solid #e6a23c; }
.barrel-icon.empty { border: 2px dashed #5d4037; }

/* 酿造设置弹窗 */
.brew-modal-content { text-align: left; }
.brew-modal-content h3 { text-align: center; color: #e6a23c; margin-top: 0; }
.step-box { background-color: #3c322a; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
.step-box label { display: block; font-weight: bold; margin-bottom: 5px; color: #d7c8b8; font-size: 12px; }
select { width: 100%; padding: 8px; background: #2c241e; color: white; border: 1px solid #8a7a68; }
.radio-group { display: flex; flex-direction: column; gap: 5px; }
.radio-group label { font-weight: normal; }

/* 酒品详情卡片 */
.wine-detail-card {
    background: #2c241e; border: 2px solid #e6a23c;
    padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;
    text-align: center;
}
.wine-tags { display: flex; justify-content: center; gap: 10px; margin: 10px 0; }
.wine-tags span { background: #3e2723; padding: 4px 8px; border-radius: 4px; font-size: 12px; color: #d7c8b8; }
.tasting-notes {
    text-align: left; background: rgba(0,0,0,0.2); padding: 15px;
    border-radius: 8px; margin-bottom: 20px; font-size: 14px; line-height: 1.6; color: #d7c8b8;
}
.wine-footer { display: flex; gap: 10px; }

/* === 剧情对话框样式 (V2.0 分层版) === */
#guide-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); z-index: 900;
    display: block; overflow: hidden;
}
.char-portrait {
    position: absolute; bottom: 0; left: -5%;
    width: 60%; height: 75%; z-index: 901;
    pointer-events: none;
    animation: slideInLeft 0.5s ease-out;
    display: flex; align-items: flex-end; 
}
.char-portrait img {
    width: 100%; height: 100%; object-fit: contain; 
    object-position: bottom center; 
    filter: drop-shadow(5px 5px 15px rgba(0,0,0,0.6));
    transition: transform 0.2s;
}
.dialog-box {
    position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%);
    width: 90%; max-width: 500px; min-height: 140px;
    background: rgba(44, 36, 29, 0.95);
    border: 2px solid #e6a23c; border-radius: 10px;
    display: flex; flex-direction: column; padding: 15px 20px;
    z-index: 902; box-shadow: 0 5px 20px rgba(0,0,0,0.8);
    animation: slideUp 0.4s ease-out;
}
.char-name {
    color: #e6a23c; font-weight: bold; font-size: 18px;
    margin-bottom: 10px; border-bottom: 1px solid rgba(230, 162, 60, 0.3);
    padding-bottom: 5px; display: inline-block;
}
.text-area { flex: 1; }
.char-text { color: #d7c8b8; font-size: 15px; line-height: 1.6; text-shadow: 1px 1px 0 #000; }
.click-tip {
    position: absolute; bottom: 10px; right: 15px;
    font-size: 12px; color: #95a5a6; animation: blink 1.5s infinite;
}
@keyframes slideInLeft { from { transform: translateX(-50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes blink { 50% { opacity: 0.3; } }

/* === 商店新布局 (上下分屏 & 互动优化) === */
.shop-container {
    display: flex; flex-direction: column;
    height: 100%; width: 100%; overflow: hidden;
}
.shop-top-section {
    height: 260px; background: linear-gradient(to bottom, #2c241e, #3e2723);
    position: relative; border-bottom: 4px solid #e6a23c;
    flex-shrink: 0; overflow: hidden;
}

/* 商店立绘：移除入场动画，增加点击手势 */
.shop-portrait-img {
    position: absolute;
    bottom: -345px; left: -38px; /* 保持你的参数 */
    height: 215%; width: auto;
    filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.5));
    z-index: 1;
    transition: transform 0.1s; /* 加快过渡，让点击反应更灵敏 */
    cursor: pointer; /* 变成小手图标 */
    transform-origin: bottom center; /* 确保缩放时底部固定 */
}

/* 点击时的弹跳效果 (!important 覆盖内联样式) */
.shop-portrait-img.bump {
    filter: brightness(1) drop-shadow(2px 2px 5px rgba(0,0,0,0.5));
}

.shop-bubble {
    position: absolute; top: 20px; right: 15px;
    width: 55%; background: #fff; color: #2c241e;
    padding: 15px; border-radius: 15px; border-bottom-left-radius: 2px;
    font-size: 13px; line-height: 1.5;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 2;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.shop-bubble::after {
    content: ''; position: absolute; bottom: -10px; left: 0;
    border-width: 10px 10px 0 0; border-style: solid;
    border-color: #fff transparent transparent transparent;
}

/* 隐藏旧的按钮区 */
.shop-actions { display: none; }

.shop-bottom-section {
    flex: 1; overflow-y: auto;
    background-color: #3c322a; display: flex; flex-direction: column;
}
@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* 金币栏悬停效果 */
.status-left .status-item:first-child:hover {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}
/* === 新版百科全书样式 (V12.0) === */
.handbook-layout {
    display: flex;
    height: 100%;
    background-color: #f4e4bc; /* 米黄色纸张背景 */
    color: #4a3f35; /* 深褐色文字 */
    font-family: 'Noto Serif SC', serif;
}

/* 左侧目录栏 */
.hb-sidebar {
    width: 80px;
    background-color: #e0d0a8;
    border-right: 2px solid #c0b088;
    display: flex;
    flex-direction: column;
    padding-top: 10px;
}

.hb-tab-btn {
    background: none;
    border: none;
    padding: 15px 5px;
    font-family: inherit;
    font-size: 12px;
    color: #8a7a68;
    cursor: pointer;
    text-align: center;
    border-bottom: 1px solid #c0b088;
    transition: all 0.2s;
}

.hb-tab-btn.active {
    background-color: #f4e4bc; /* 选中时与右侧背景融合 */
    color: #5d4037;
    font-weight: bold;
    border-right: 2px solid #f4e4bc; /* 遮住边框 */
    margin-right: -2px;
    position: relative;
    z-index: 2;
}

.hb-tab-btn i {
    display: block;
    font-size: 20px;
    margin-bottom: 5px;
    color: #5d4037;
}

/* 右侧内容区 */
.hb-content-area {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    position: relative;
}

/* 书页标题 */
.hb-page-title {
    font-size: 24px;
    font-weight: bold;
    color: #5d4037;
    border-bottom: 2px solid #5d4037;
    padding-bottom: 10px;
    margin-bottom: 20px;
    text-align: center;
}

/* 条目卡片 */
.hb-card {
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid #c0b088;
    border-radius: 4px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
}

.hb-card.locked {
    opacity: 0.6;
    background: rgba(0, 0, 0, 0.05);
    border-style: dashed;
}

.hb-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    font-weight: bold;
    font-size: 16px;
    color: #8d6e63;
}

.hb-tag {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    background: #5d4037;
    color: #f4e4bc;
}

.hb-desc {
    font-size: 13px;
    line-height: 1.6;
    color: #4a3f35;
}

/* 葡萄详情里的等级解锁条 */
.hb-progress-row {
    display: flex;
    gap: 5px;
    margin-top: 10px;
}
.hb-progress-item {
    flex: 1;
    height: 6px;
    background: #d7ccc8;
    border-radius: 3px;
}
.hb-progress-item.unlocked {
    background: #8d6e63; /* 解锁后变深色 */
}
/* === 帮助系统样式 === */
.help-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 24px;
    height: 24px;
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid #8a7a68;
    border-radius: 50%;
    color: #d7c8b8;
    font-size: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 90; /* 保证在最上层，但在弹窗之下 */
    transition: all 0.2s;
}

.help-btn:hover {
    background-color: #e6a23c;
    color: #2c241e;
    transform: scale(1.1);
}

/* 帮助弹窗的内容样式 */
.help-content {
    text-align: left;
    font-size: 13px;
    line-height: 1.6;
    color: #d7c8b8;
}
.help-content h4 {
    color: #e6a23c;
    margin: 10px 0 5px 0;
    border-bottom: 1px dashed #5d4037;
    padding-bottom: 3px;
}
.help-content ul {
    margin: 0;
    padding-left: 20px;
}
.help-content li {
    margin-bottom: 5px;
}

